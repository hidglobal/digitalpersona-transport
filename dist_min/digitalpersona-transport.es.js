const t={None:1,Encoding:2,Encryption:3,AESEncryption:4};function e(...t){r.debug&&console.log(...t)}class s{constructor(e={}){this._version=t.AESEncryption,this.debug=e.debug||!1,e.version&&(this.version=e.version)}get version(){return this._version}set version(e){if(!e||!Object.values(t).includes(e))throw new Error("invalid WebSdkEncryptionSupport");r.version>=t.AESEncryption&&(void 0===globalThis.crypto||!globalThis.crypto.subtle)&&(r.version=t.Encryption),this._version=e}}const r={debug:!1,version:4};class i{constructor(t,e,s){null!=t&&("number"==typeof t?this.fromNumber(t,e,s):null==e&&"string"!=typeof t?this.fromString(t,256):this.fromString(t,e))}copyTo(t){for(var e=this.t-1;e>=0;--e)t[e]=this[e];t.t=this.t,t.s=this.s}fromInt(t){this.t=1,this.s=t<0?-1:0,t>0?this[0]=t:t<-1?this[0]=t+this.DV:this.t=0}fromString(t,e){var s;if(16==e)s=4;else if(8==e)s=3;else if(256==e)s=8;else if(2==e)s=1;else if(32==e)s=5;else{if(4!=e)return void this.fromRadix(t,e);s=2}this.t=0,this.s=0;for(var r=t.length,n=!1,o=0;--r>=0;){var h=8==s?255&t[r]:E(t,r);h<0?"-"==t.charAt(r)&&(n=!0):(n=!1,0==o?this[this.t++]=h:o+s>this.DB?(this[this.t-1]|=(h&(1<<this.DB-o)-1)<<o,this[this.t++]=h>>this.DB-o):this[this.t-1]|=h<<o,(o+=s)>=this.DB&&(o-=this.DB))}8==s&&0!=(128&t[0])&&(this.s=-1,o>0&&(this[this.t-1]|=(1<<this.DB-o)-1<<o)),this.clamp(),n&&i.ZERO.subTo(this,this)}clamp(){for(var t=this.s&this.DM;this.t>0&&this[this.t-1]==t;)--this.t}toString(t=10){if(this.s<0)return"-"+this.negate().toString(t);var e;if(16==t)e=4;else if(8==t)e=3;else if(2==t)e=1;else if(32==t)e=5;else{if(4!=t)return this.toRadix(t);e=2}var s,r=(1<<e)-1,i=!1,n="",o=this.t,h=this.DB-o*this.DB%e;if(o-- >0)for(h<this.DB&&(s=this[o]>>h)>0&&(i=!0,n=u(s));o>=0;)h<e?(s=(this[o]&(1<<h)-1)<<e-h,s|=this[--o]>>(h+=this.DB-e)):(s=this[o]>>(h-=e)&r,h<=0&&(h+=this.DB,--o)),s>0&&(i=!0),i&&(n+=u(s));return i?n:"0"}negate(){var t=n();return i.ZERO.subTo(this,t),t}abs(){return this.s<0?this.negate():this}compareTo(t){var e=this.s-t.s;if(0!=e)return e;var s=this.t;if(0!=(e=s-t.t))return this.s<0?-e:e;for(;--s>=0;)if(0!=(e=this[s]-t[s]))return e;return 0}bitLength(){return this.t<=0?0:this.DB*(this.t-1)+D(this[this.t-1]^this.s&this.DM)}dlShiftTo(t,e){var s;for(s=this.t-1;s>=0;--s)e[s+t]=this[s];for(s=t-1;s>=0;--s)e[s]=0;e.t=this.t+t,e.s=this.s}drShiftTo(t,e){for(var s=t;s<this.t;++s)e[s-t]=this[s];e.t=Math.max(this.t-t,0),e.s=this.s}lShiftTo(t,e){var s,r=t%this.DB,i=this.DB-r,n=(1<<i)-1,o=Math.floor(t/this.DB),h=this.s<<r&this.DM;for(s=this.t-1;s>=0;--s)e[s+o+1]=this[s]>>i|h,h=(this[s]&n)<<r;for(s=o-1;s>=0;--s)e[s]=0;e[o]=h,e.t=this.t+o+1,e.s=this.s,e.clamp()}rShiftTo(t,e){e.s=this.s;var s=Math.floor(t/this.DB);if(s>=this.t)e.t=0;else{var r=t%this.DB,i=this.DB-r,n=(1<<r)-1;e[0]=this[s]>>r;for(var o=s+1;o<this.t;++o)e[o-s-1]|=(this[o]&n)<<i,e[o-s]=this[o]>>r;r>0&&(e[this.t-s-1]|=(this.s&n)<<i),e.t=this.t-s,e.clamp()}}subTo(t,e){for(var s=0,r=0,i=Math.min(t.t,this.t);s<i;)r+=this[s]-t[s],e[s++]=r&this.DM,r>>=this.DB;if(t.t<this.t){for(r-=t.s;s<this.t;)r+=this[s],e[s++]=r&this.DM,r>>=this.DB;r+=this.s}else{for(r+=this.s;s<t.t;)r-=t[s],e[s++]=r&this.DM,r>>=this.DB;r-=t.s}e.s=r<0?-1:0,r<-1?e[s++]=this.DV+r:r>0&&(e[s++]=r),e.t=s,e.clamp()}multiplyTo(t,e){var s=this.abs(),r=t.abs(),n=s.t;for(e.t=n+r.t;--n>=0;)e[n]=0;for(n=0;n<r.t;++n)e[n+s.t]=s.am(0,r[n],e,n,0,s.t);e.s=0,e.clamp(),this.s!=t.s&&i.ZERO.subTo(e,e)}squareTo(t){for(var e=this.abs(),s=t.t=2*e.t;--s>=0;)t[s]=0;for(s=0;s<e.t-1;++s){var r=e.am(s,e[s],t,2*s,0,1);(t[s+e.t]+=e.am(s+1,2*e[s],t,2*s+1,r,e.t-s-1))>=e.DV&&(t[s+e.t]-=e.DV,t[s+e.t+1]=1)}t.t>0&&(t[t.t-1]+=e.am(s,e[s],t,2*s,0,1)),t.s=0,t.clamp()}divRemTo(t,e,s){var r=t.abs();if(!(r.t<=0)){var o=this.abs();if(o.t<r.t)return null!=e&&e.fromInt(0),void(null!=s&&this.copyTo(s));null==s&&(s=n());var h=n(),a=this.s,c=t.s,l=this.DB-D(r[r.t-1]);l>0?(r.lShiftTo(l,h),o.lShiftTo(l,s)):(r.copyTo(h),o.copyTo(s));var u=h.t,E=h[u-1];if(0!=E){var B=E*(1<<this.F1)+(u>1?h[u-2]>>this.F2:0),f=this.FV/B,C=(1<<this.F1)/B,F=1<<this.F2,A=s.t,d=A-u,p=null==e?n():e;for(h.dlShiftTo(d,p),s.compareTo(p)>=0&&(s[s.t++]=1,s.subTo(p,s)),i.ONE.dlShiftTo(u,p),p.subTo(h,h);h.t<u;)h[h.t++]=0;for(;--d>=0;){var m=s[--A]==E?this.DM:Math.floor(s[A]*f+(s[A-1]+F)*C);if((s[A]+=h.am(0,m,s,d,0,u))<m)for(h.dlShiftTo(d,p),s.subTo(p,s);s[A]<--m;)s.subTo(p,s)}null!=e&&(s.drShiftTo(u,e),a!=c&&i.ZERO.subTo(e,e)),s.t=u,s.clamp(),l>0&&s.rShiftTo(l,s),a<0&&i.ZERO.subTo(s,s)}}}mod(t){var e=n();return this.abs().divRemTo(t,null,e),this.s<0&&e.compareTo(i.ZERO)>0&&t.subTo(e,e),e}invDigit(){if(this.t<1)return 0;var t=this[0];if(0==(1&t))return 0;var e=3&t;return(e=(e=(e=(e=e*(2-(15&t)*e)&15)*(2-(255&t)*e)&255)*(2-((65535&t)*e&65535))&65535)*(2-t*e%this.DV)%this.DV)>0?this.DV-e:-e}isEven(){return 0==(this.t>0?1&this[0]:this.s)}exp(t,e){if(t>4294967295||t<1)return i.ONE;var s=n(),r=n(),o=e.convert(this),h=D(t)-1;for(o.copyTo(s);--h>=0;)if(e.sqrTo(s,r),(t&1<<h)>0)e.mulTo(r,o,s);else{var a=s;s=r,r=a}return e.revert(s)}modPowInt(t,e){var s;return s=t<256||e.isEven()?new f(e):new C(e),this.exp(t,s)}clone(){var t=n();return this.copyTo(t),t}intValue(){if(this.s<0){if(1==this.t)return this[0]-this.DV;if(0==this.t)return-1}else{if(1==this.t)return this[0];if(0==this.t)return 0}return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]}byteValue(){return 0==this.t?this.s:this[0]<<24>>24}shortValue(){return 0==this.t?this.s:this[0]<<16>>16}chunkSize(t){return Math.floor(Math.LN2*this.DB/Math.log(t))}signum(){return this.s<0?-1:this.t<=0||1==this.t&&this[0]<=0?0:1}toRadix(t){if(null==t&&(t=10),0==this.signum()||t<2||t>36)return"0";var e=this.chunkSize(t),s=Math.pow(t,e),r=B(s),i=n(),o=n(),h="";for(this.divRemTo(r,i,o);i.signum()>0;)h=(s+o.intValue()).toString(t).substr(1)+h,i.divRemTo(r,i,o);return o.intValue().toString(t)+h}fromRadix(t,e){this.fromInt(0),null==e&&(e=10);for(var s=this.chunkSize(e),r=Math.pow(e,s),n=!1,o=0,h=0,a=0;a<t.length;++a){var c=E(t,a);c<0?"-"==t.charAt(a)&&0==this.signum()&&(n=!0):(h=e*h+c,++o>=s&&(this.dMultiply(r),this.dAddOffset(h,0),o=0,h=0))}o>0&&(this.dMultiply(Math.pow(e,o)),this.dAddOffset(h,0)),n&&i.ZERO.subTo(this,this)}fromNumber(t,e,s){if("number"==typeof e)if(t<2)this.fromInt(1);else for(this.fromNumber(t,s),this.testBit(t-1)||this.bitwiseTo(i.ONE.shiftLeft(t-1),A,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(e);)this.dAddOffset(2,0),this.bitLength()>t&&this.subTo(i.ONE.shiftLeft(t-1),this);else{var r=new Array,n=7&t;r.length=1+(t>>3),e.nextBytes(r),n>0?r[0]&=(1<<n)-1:r[0]=0,this.fromString(r,256)}}toByteArray(){var t=this.t,e=new Array;e[0]=this.s;var s,r=this.DB-t*this.DB%8,i=0;if(t-- >0)for(r<this.DB&&(s=this[t]>>r)!=(this.s&this.DM)>>r&&(e[i++]=s|this.s<<this.DB-r);t>=0;)r<8?(s=(this[t]&(1<<r)-1)<<8-r,s|=this[--t]>>(r+=this.DB-8)):(s=this[t]>>(r-=8)&255,r<=0&&(r+=this.DB,--t)),0!=(128&s)&&(s|=-256),0==i&&(128&this.s)!=(128&s)&&++i,(i>0||s!=this.s)&&(e[i++]=s);return e}equals(t){return 0==this.compareTo(t)}min(t){return this.compareTo(t)<0?this:t}max(t){return this.compareTo(t)>0?this:t}bitwiseTo(t,e,s){var r,i,n=Math.min(t.t,this.t);for(r=0;r<n;++r)s[r]=e(this[r],t[r]);if(t.t<this.t){for(i=t.s&this.DM,r=n;r<this.t;++r)s[r]=e(this[r],i);s.t=this.t}else{for(i=this.s&this.DM,r=n;r<t.t;++r)s[r]=e(i,t[r]);s.t=t.t}s.s=e(this.s,t.s),s.clamp()}and(t){var e=n();return this.bitwiseTo(t,F,e),e}or(t){var e=n();return this.bitwiseTo(t,A,e),e}xor(t){var e=n();return this.bitwiseTo(t,d,e),e}andNot(t){var e=n();return this.bitwiseTo(t,p,e),e}not(){for(var t=n(),e=0;e<this.t;++e)t[e]=this.DM&~this[e];return t.t=this.t,t.s=~this.s,t}shiftLeft(t){var e=n();return t<0?this.rShiftTo(-t,e):this.lShiftTo(t,e),e}shiftRight(t){var e=n();return t<0?this.lShiftTo(-t,e):this.rShiftTo(t,e),e}getLowestSetBit(){for(var t=0;t<this.t;++t)if(0!=this[t])return t*this.DB+m(this[t]);return this.s<0?this.t*this.DB:-1}bitCount(){for(var t=0,e=this.s&this.DM,s=0;s<this.t;++s)t+=g(this[s]^e);return t}testBit(t){var e=Math.floor(t/this.DB);return e>=this.t?0!=this.s:0!=(this[e]&1<<t%this.DB)}changeBit(t,e){var s=i.ONE.shiftLeft(t);return this.bitwiseTo(s,e,s),s}setBit(t){return this.changeBit(t,A)}clearBit(t){return this.changeBit(t,p)}flipBit(t){return this.changeBit(t,d)}addTo(t,e){for(var s=0,r=0,i=Math.min(t.t,this.t);s<i;)r+=this[s]+t[s],e[s++]=r&this.DM,r>>=this.DB;if(t.t<this.t){for(r+=t.s;s<this.t;)r+=this[s],e[s++]=r&this.DM,r>>=this.DB;r+=this.s}else{for(r+=this.s;s<t.t;)r+=t[s],e[s++]=r&this.DM,r>>=this.DB;r+=t.s}e.s=r<0?-1:0,r>0?e[s++]=r:r<-1&&(e[s++]=this.DV+r),e.t=s,e.clamp()}add(t){var e=n();return this.addTo(t,e),e}subtract(t){var e=n();return this.subTo(t,e),e}multiply(t){var e=n();return this.multiplyTo(t,e),e}square(){var t=n();return this.squareTo(t),t}divide(t){var e=n();return this.divRemTo(t,e,null),e}remainder(t){var e=n();return this.divRemTo(t,null,e),e}divideAndRemainder(t){var e=n(),s=n();return this.divRemTo(t,e,s),new Array(e,s)}dMultiply(t){this[this.t]=this.am(0,t-1,this,0,0,this.t),++this.t,this.clamp()}dAddOffset(t,e){if(0!=t){for(;this.t<=e;)this[this.t++]=0;for(this[e]+=t;this[e]>=this.DV;)this[e]-=this.DV,++e>=this.t&&(this[this.t++]=0),++this[e]}}pow(t){return this.exp(t,new v)}multiplyLowerTo(t,e,s){var r,i=Math.min(this.t+t.t,e);for(s.s=0,s.t=i;i>0;)s[--i]=0;for(r=s.t-this.t;i<r;++i)s[i+this.t]=this.am(0,t[i],s,i,0,this.t);for(r=Math.min(t.t,e);i<r;++i)this.am(0,t[i],s,i,0,e-i);s.clamp()}multiplyUpperTo(t,e,s){--e;var r=s.t=this.t+t.t-e;for(s.s=0;--r>=0;)s[r]=0;for(r=Math.max(e-this.t,0);r<t.t;++r)s[this.t+r-e]=this.am(e-r,t[r],s,0,0,this.t+r-e);s.clamp(),s.drShiftTo(1,s)}modPow(t,e){var s,r,i=t.bitLength(),o=B(1);if(i<=0)return o;s=i<18?1:i<48?3:i<144?4:i<768?5:6,r=i<8?new f(e):e.isEven()?new _(e):new C(e);var h=new Array,a=3,c=s-1,l=(1<<s)-1;if(h[1]=r.convert(this),s>1){var u=n();for(r.sqrTo(h[1],u);a<=l;)h[a]=n(),r.mulTo(u,h[a-2],h[a]),a+=2}var E,F,A=t.t-1,d=!0,p=n();for(i=D(t[A])-1;A>=0;){for(i>=c?E=t[A]>>i-c&l:(E=(t[A]&(1<<i+1)-1)<<c-i,A>0&&(E|=t[A-1]>>this.DB+i-c)),a=s;0==(1&E);)E>>=1,--a;if((i-=a)<0&&(i+=this.DB,--A),d)h[E].copyTo(o),d=!1;else{for(;a>1;)r.sqrTo(o,p),r.sqrTo(p,o),a-=2;a>0?r.sqrTo(o,p):(F=o,o=p,p=F),r.mulTo(p,h[E],o)}for(;A>=0&&0==(t[A]&1<<i);)r.sqrTo(o,p),F=o,o=p,p=F,--i<0&&(i=this.DB-1,--A)}return r.revert(o)}gcd(t){var e=this.s<0?this.negate():this.clone(),s=t.s<0?t.negate():t.clone();if(e.compareTo(s)<0){var r=e;e=s,s=r}var i=e.getLowestSetBit(),n=s.getLowestSetBit();if(n<0)return e;for(i<n&&(n=i),n>0&&(e.rShiftTo(n,e),s.rShiftTo(n,s));e.signum()>0;)(i=e.getLowestSetBit())>0&&e.rShiftTo(i,e),(i=s.getLowestSetBit())>0&&s.rShiftTo(i,s),e.compareTo(s)>=0?(e.subTo(s,e),e.rShiftTo(1,e)):(s.subTo(e,s),s.rShiftTo(1,s));return n>0&&s.lShiftTo(n,s),s}modInt(t){if(t<=0)return 0;var e=this.DV%t,s=this.s<0?t-1:0;if(this.t>0)if(0==e)s=this[0]%t;else for(var r=this.t-1;r>=0;--r)s=(e*s+this[r])%t;return s}modInverse(t){var e=t.isEven();if(this.isEven()&&e||0==t.signum())return i.ZERO;for(var s=t.clone(),r=this.clone(),n=B(1),o=B(0),h=B(0),a=B(1);0!=s.signum();){for(;s.isEven();)s.rShiftTo(1,s),e?(n.isEven()&&o.isEven()||(n.addTo(this,n),o.subTo(t,o)),n.rShiftTo(1,n)):o.isEven()||o.subTo(t,o),o.rShiftTo(1,o);for(;r.isEven();)r.rShiftTo(1,r),e?(h.isEven()&&a.isEven()||(h.addTo(this,h),a.subTo(t,a)),h.rShiftTo(1,h)):a.isEven()||a.subTo(t,a),a.rShiftTo(1,a);s.compareTo(r)>=0?(s.subTo(r,s),e&&n.subTo(h,n),o.subTo(a,o)):(r.subTo(s,r),e&&h.subTo(n,h),a.subTo(o,a))}return 0!=r.compareTo(i.ONE)?i.ZERO:a.compareTo(t)>=0?a.subtract(t):a.signum()<0?(a.addTo(t,a),a.signum()<0?a.add(t):a):a}isProbablePrime(t){var e,s=this.abs();if(1==s.t&&s[0]<=w[w.length-1]){for(e=0;e<w.length;++e)if(s[0]==w[e])return!0;return!1}if(s.isEven())return!1;for(e=1;e<w.length;){for(var r=w[e],i=e+1;i<w.length&&r<T;)r*=w[i++];for(r=s.modInt(r);e<i;)if(r%w[e++]==0)return!1}return s.millerRabin(t)}millerRabin(t){var e=this.subtract(i.ONE),s=e.getLowestSetBit();if(s<=0)return!1;var r=e.shiftRight(s);(t=t+1>>1)>w.length&&(t=w.length);for(var o=n(),h=0;h<t;++h){o.fromInt(w[Math.floor(Math.random()*w.length)]);var a=o.modPow(r,this);if(0!=a.compareTo(i.ONE)&&0!=a.compareTo(e)){for(var c=1;c++<s&&0!=a.compareTo(e);)if(0==(a=a.modPowInt(2,this)).compareTo(i.ONE))return!1;if(0!=a.compareTo(e))return!1}}return!0}}function n(){return new i(null)}var o;i.ZERO=B(0),i.ONE=B(1),"Microsoft Internet Explorer"==navigator.appName?(i.prototype.am=function(t,e,s,r,i,n){for(var o=32767&e,h=e>>15;--n>=0;){var a=32767&this[t],c=this[t++]>>15,l=h*a+c*o;i=((a=o*a+((32767&l)<<15)+s[r]+(1073741823&i))>>>30)+(l>>>15)+h*c+(i>>>30),s[r++]=1073741823&a}return i},o=30):"Netscape"!=navigator.appName?(i.prototype.am=function(t,e,s,r,i,n){for(;--n>=0;){var o=e*this[t++]+s[r]+i;i=Math.floor(o/67108864),s[r++]=67108863&o}return i},o=26):(i.prototype.am=function(t,e,s,r,i,n){for(var o=16383&e,h=e>>14;--n>=0;){var a=16383&this[t],c=this[t++]>>14,l=h*a+c*o;i=((a=o*a+((16383&l)<<14)+s[r]+i)>>28)+(l>>14)+h*c,s[r++]=268435455&a}return i},o=28),i.prototype.DB=o,i.prototype.DM=(1<<o)-1,i.prototype.DV=1<<o;i.prototype.FV=Math.pow(2,52),i.prototype.F1=52-o,i.prototype.F2=2*o-52;var h,a,c="0123456789abcdefghijklmnopqrstuvwxyz",l=new Array;for(h="0".charCodeAt(0),a=0;a<=9;++a)l[h++]=a;for(h="a".charCodeAt(0),a=10;a<36;++a)l[h++]=a;for(h="A".charCodeAt(0),a=10;a<36;++a)l[h++]=a;function u(t){return c.charAt(t)}function E(t,e){var s=l[t.charCodeAt(e)];return null==s?-1:s}function B(t){var e=n();return e.fromInt(t),e}function D(t){var e,s=1;return 0!=(e=t>>>16)&&(t=e,s+=16),0!=(e=t>>8)&&(t=e,s+=8),0!=(e=t>>4)&&(t=e,s+=4),0!=(e=t>>2)&&(t=e,s+=2),0!=(e=t>>1)&&(t=e,s+=1),s}class f{constructor(t){this.m=t,this.m=t}convert(t){return t.s<0||t.compareTo(this.m)>=0?t.mod(this.m):t}revert(t){return t}reduce(t){t.divRemTo(this.m,null,t)}mulTo(t,e,s){t.multiplyTo(e,s),this.reduce(s)}sqrTo(t,e){t.squareTo(e),this.reduce(e)}}class C{constructor(t){this.m=t,this.m=t,this.mp=t.invDigit(),this.mpl=32767&this.mp,this.mph=this.mp>>15,this.um=(1<<t.DB-15)-1,this.mt2=2*t.t}convert(t){var e=n();return t.abs().dlShiftTo(this.m.t,e),e.divRemTo(this.m,null,e),t.s<0&&e.compareTo(i.ZERO)>0&&this.m.subTo(e,e),e}revert(t){var e=n();return t.copyTo(e),this.reduce(e),e}reduce(t){for(;t.t<=this.mt2;)t[t.t++]=0;for(var e=0;e<this.m.t;++e){var s=32767&t[e],r=s*this.mpl+((s*this.mph+(t[e]>>15)*this.mpl&this.um)<<15)&t.DM;for(t[s=e+this.m.t]+=this.m.am(0,r,t,e,0,this.m.t);t[s]>=t.DV;)t[s]-=t.DV,t[++s]++}t.clamp(),t.drShiftTo(this.m.t,t),t.compareTo(this.m)>=0&&t.subTo(this.m,t)}sqrTo(t,e){t.squareTo(e),this.reduce(e)}mulTo(t,e,s){t.multiplyTo(e,s),this.reduce(s)}}function F(t,e){return t&e}function A(t,e){return t|e}function d(t,e){return t^e}function p(t,e){return t&~e}function m(t){if(0==t)return-1;var e=0;return 0==(65535&t)&&(t>>=16,e+=16),0==(255&t)&&(t>>=8,e+=8),0==(15&t)&&(t>>=4,e+=4),0==(3&t)&&(t>>=2,e+=2),0==(1&t)&&++e,e}function g(t){for(var e=0;0!=t;)t&=t-1,++e;return e}class v{convert(t){return t}revert(t){return t}mulTo(t,e,s){t.multiplyTo(e,s)}sqrTo(t,e){t.squareTo(e)}}class _{constructor(t){this.m=t,this.r2=n(),this.q3=n(),i.ONE.dlShiftTo(2*t.t,this.r2),this.mu=this.r2.divide(t),this.m=t}convert(t){if(t.s<0||t.t>2*this.m.t)return t.mod(this.m);if(t.compareTo(this.m)<0)return t;var e=n();return t.copyTo(e),this.reduce(e),e}revert(t){return t}reduce(t){for(t.drShiftTo(this.m.t-1,this.r2),t.t>this.m.t+1&&(t.t=this.m.t+1,t.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);t.compareTo(this.r2)<0;)t.dAddOffset(1,this.m.t+1);for(t.subTo(this.r2,t);t.compareTo(this.m)>=0;)t.subTo(this.m,t)}sqrTo(t,e){t.squareTo(e),this.reduce(e)}mulTo(t,e,s){t.multiplyTo(e,s),this.reduce(s)}}var w=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997],T=(1<<26)/w[w.length-1];const y="0123456789abcdef";function b(t){for(var e="",s=7;s>=0;s--)e+=y.charAt(t>>4*s&15);return e}function S(t,e){var s=(65535&t)+(65535&e);return(t>>16)+(e>>16)+(s>>16)<<16|65535&s}function R(t,e){return t<<e|t>>>32-e}function x(t,e,s,r){return t<20?e&s|~e&r:t<40?e^s^r:t<60?e&s|e&r|s&r:e^s^r}function I(t){return t<20?1518500249:t<40?1859775393:t<60?-1894007588:-899497514}function M(t){return e=function(t){for(var e=1+(t.length+8>>6),s=new Array(16*e),r=0;r<16*e;r++)s[r]=0;for(r=0;r<t.length;r++)s[r>>2]|=t.charCodeAt(r)<<24-r%4*8;return s[r>>2]|=128<<24-r%4*8,s[16*e-1]=8*t.length,s}(t),s=function(t){for(var e=new Array(80),s=1732584193,r=-271733879,i=-1732584194,n=271733878,o=-1009589776,h=0;h<t.length;h+=16){for(var a=s,c=r,l=i,u=n,E=o,B=0;B<80;B++){var D;e[B]=B<16?t[h+B]:R(e[B-3]^e[B-8]^e[B-14]^e[B-16],1),D=S(S(R(s,5),x(B,r,i,n)),S(S(o,e[B]),I(B))),o=n,n=i,i=R(r,30),r=s,s=D}s=S(s,a),r=S(r,c),i=S(i,l),n=S(n,u),o=S(o,E)}return new Array(s,r,i,n,o)}(e),b(s[0])+b(s[1])+b(s[2])+b(s[3])+b(s[4]);var e,s}class N extends Array{static bitSlice(t,e,s){return t=this._shiftRight(t.slice(e/32),32-(31&e)).slice(1),void 0===s?t:this.clamp(t,s-e)}static extract(t,e,s){var r=Math.floor(-e-s&31);return(-32&(e+s-1^e)?t[e/32|0]<<32-r^t[e/32+1|0]>>>r:t[e/32|0]>>>r)&(1<<s)-1}static concat(t,e){if(0===t.length||0===e.length)return t.concat(e);var s=t[t.length-1],r=this.getPartial(s);return 32===r?t.concat(e):this._shiftRight(e,r,0|s,t.slice(0,t.length-1))}static bitLength(t){var e,s=t.length;return 0===s?0:(e=t[s-1],32*(s-1)+this.getPartial(e))}static clamp(t,e){if(32*t.length<e)return t;var s=(t=t.slice(0,Math.ceil(e/32))).length;return e&=31,s>0&&e&&(t[s-1]=this.partial(e,t[s-1]&2147483648>>e-1,1)),t}static partial(t,e,s){return 32===t?e:(s?0|e:e<<32-t)+1099511627776*t}static getPartial(t){return Math.round(t/1099511627776)||32}static equal(t,e){if(this.bitLength(t)!==this.bitLength(e))return!1;var s,r=0;for(s=0;s<t.length;s++)r|=t[s]^e[s];return 0===r}static _shiftRight(t,e,s,r){var i,n,o;for(void 0===r&&(r=[]);e>=32;e-=32)r.push(s),s=0;if(0===e)return r.concat(t);for(i=0;i<t.length;i++)r.push(s|t[i]>>>e),s=t[i]<<32-e;return n=t.length?t[t.length-1]:0,o=this.getPartial(n),r.push(this.partial(e+o&31,e+o>32?s:r.pop(),1)),r}static _xor4(t,e){return[t[0]^e[0],t[1]^e[1],t[2]^e[2],t[3]^e[3]]}static byteswapM(t){var e,s;for(e=0;e<t.length;++e)s=t[e],t[e]=s>>>24|s>>>8&65280|(65280&s)<<8|s<<24;return t}}class k{constructor(t){this.message=t}toString(){return`INVALID: ${this.message}`}}class O{constructor(t){this.message=t}toString(){return"BUG: "+this.message}}class L{constructor(t){this.message=t}toString(){return"NOT READY: "+this.message}}var P=Object.freeze({__proto__:null,bug:O,corrupt:class{constructor(t){this.message=t}toString(){return`CORRUPT: ${this.message}`}},invalid:k,notReady:L});class H{constructor(t){this._tables=[[[],[],[],[],[]],[[],[],[],[],[]]],this._tables[0][0][0]||this._precompute();var e,s,r,i,n,o=this._tables[0][4],h=this._tables[1],a=t.length,c=1;if(4!==a&&6!==a&&8!==a)throw new k("invalid aes key size");for(this._key=[i=t.slice(0),n=[]],e=a;e<4*a+28;e++)r=i[e-1],(e%a==0||8===a&&e%a==4)&&(r=o[r>>>24]<<24^o[r>>16&255]<<16^o[r>>8&255]<<8^o[255&r],e%a==0&&(r=r<<8^r>>>24^c<<24,c=c<<1^283*(c>>7))),i[e]=i[e-a]^r;for(s=0;e;s++,e--)r=i[3&s?e:e-4],n[s]=e<=4||s<4?r:h[0][o[r>>>24]]^h[1][o[r>>16&255]]^h[2][o[r>>8&255]]^h[3][o[255&r]]}encrypt(t){return this._crypt(t,0)}decrypt(t){return this._crypt(t,1)}_precompute(){var t,e,s,r,i,n,o,h,a=this._tables[0],c=this._tables[1],l=a[4],u=c[4],E=[],B=[];for(t=0;t<256;t++)B[(E[t]=t<<1^283*(t>>7))^t]=t;for(e=s=0;!l[e];e^=r||1,s=B[s]||1)for(n=(n=s^s<<1^s<<2^s<<3^s<<4)>>8^255&n^99,l[e]=n,u[n]=e,h=16843009*E[i=E[r=E[e]]]^65537*i^257*r^16843008*e,o=257*E[n]^16843008*n,t=0;t<4;t++)a[t][e]=o=o<<24^o>>>8,c[t][n]=h=h<<24^h>>>8;for(t=0;t<5;t++)a[t]=a[t].slice(0),c[t]=c[t].slice(0)}_crypt(t,e){if(4!==t.length)throw new k("invalid aes block size");var s,r,i,n,o=this._key[e],h=t[0]^o[0],a=t[e?3:1]^o[1],c=t[2]^o[2],l=t[e?1:3]^o[3],u=o.length/4-2,E=4,B=[0,0,0,0],D=this._tables[e],f=D[0],C=D[1],F=D[2],A=D[3],d=D[4];for(n=0;n<u;n++)s=f[h>>>24]^C[a>>16&255]^F[c>>8&255]^A[255&l]^o[E],r=f[a>>>24]^C[c>>16&255]^F[l>>8&255]^A[255&h]^o[E+1],i=f[c>>>24]^C[l>>16&255]^F[h>>8&255]^A[255&a]^o[E+2],l=f[l>>>24]^C[h>>16&255]^F[a>>8&255]^A[255&c]^o[E+3],E+=4,h=s,a=r,c=i;for(n=0;n<4;n++)B[e?3&-n:n]=d[h>>>24]<<24^d[a>>16&255]<<16^d[c>>8&255]<<8^d[255&l]^o[E++],s=h,h=a,a=c,c=l,l=s;return B}}var U=Object.freeze({__proto__:null,aes:H});class q{static fromBits(t){var e,s="",r=N.bitLength(t),i=0;for(e=0;e<r/8;e++)0==(3&e)&&(i=t[e/4]),s+=String.fromCharCode(i>>>24),i<<=8;return decodeURIComponent(escape(s))}static toBits(t){t=unescape(encodeURIComponent(t));var e,s=[],r=0;for(e=0;e<t.length;e++)r=r<<8|t.charCodeAt(e),3==(3&e)&&(s.push(r),r=0);return 3&e&&s.push(N.partial(8*(3&e),r)),s}}class V{static fromBits(t,e,s){var r,i="",n=0,o=this._chars,h=0,a=N.bitLength(t);for(s&&(o=o.substr(0,62)+"-_"),r=0;6*i.length<a;)i+=o.charAt((h^t[r]>>>n)>>>26),n<6?(h=t[r]<<6-n,n+=26,r++):(h<<=6,n-=6);for(;3&i.length&&!e;)i+="=";return i}static toBits(t,e){t=t.replace(/\s|=/g,"");var s,r,i=[],n=0,o=this._chars,h=0;for(e&&(o=o.substr(0,62)+"-_"),s=0;s<t.length;s++){if((r=o.indexOf(t.charAt(s)))<0)throw new k("this isn't base64!");n>26?(n-=26,i.push(h^r>>>n),h=r<<32-n):h^=r<<32-(n+=6)}return 56&n&&i.push(N.partial(56&n,h,1)),i}}V._chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";var z=Object.freeze({__proto__:null,base64:V,base64url:class{static fromBits(t){return V.fromBits(t,1,1)}static toBits(t){return V.toBits(t,1)}},hex:class{static fromBits(t){var e,s="";for(e=0;e<t.length;e++)s+=(0xf00000000000+(0|t[e])).toString(16).substr(4);return s.substring(0,N.bitLength(t)/4)}static toBits(t){var e,s,r=[];for(s=(t=t.replace(/\s|0x/g,"")).length,t+="00000000",e=0;e<t.length;e+=8)r.push(0^parseInt(t.substr(e,8),16));return N.clamp(r,4*s)}},utf8String:q});class ${constructor(t){this._h=[],this._buffer=[],this._length=0,$._key[0]||this._precompute(),t?(this._h=t._h.slice(0),this._buffer=t._buffer.slice(0),this._length=t._length):this.reset()}static hash(t){return(new $).update(t).finalize()}reset(){return this._h=$._init.slice(0),this._buffer=[],this._length=0,this}update(t){"string"==typeof t&&(t=q.toBits(t));var e,s=this._buffer=N.concat(this._buffer,t),r=this._length,i=this._length=r+N.bitLength(t);for(e=512+r&-512;e<=i;e+=512)this._block(s.splice(0,16));return this}finalize(){var t,e=this._buffer,s=this._h;for(t=(e=N.concat(e,[N.partial(1,1)])).length+2;15&t;t++)e.push(0);for(e.push(Math.floor(this._length/4294967296)),e.push(0|this._length);e.length;)this._block(e.splice(0,16));return this.reset(),s}_precompute(){var t,e=0,s=2;function r(t){return 4294967296*(t-Math.floor(t))|0}t:for(;e<64;s++){for(t=2;t*t<=s;t++)if(s%t==0)continue t;e<8&&($._init[e]=r(Math.pow(s,.5))),$._key[e]=r(Math.pow(s,1/3)),e++}}_block(t){var e,s,r,i,n=t.slice(0),o=this._h,h=$._key,a=o[0],c=o[1],l=o[2],u=o[3],E=o[4],B=o[5],D=o[6],f=o[7];for(e=0;e<64;e++)e<16?s=n[e]:(r=n[e+1&15],i=n[e+14&15],s=n[15&e]=(r>>>7^r>>>18^r>>>3^r<<25^r<<14)+(i>>>17^i>>>19^i>>>10^i<<15^i<<13)+n[15&e]+n[e+9&15]|0),s=s+f+(E>>>6^E>>>11^E>>>25^E<<26^E<<21^E<<7)+(D^E&(B^D))+h[e],f=D,D=B,B=E,E=u+s|0,u=l,l=c,a=s+((c=a)&l^u&(c^l))+(c>>>2^c>>>13^c>>>22^c<<30^c<<19^c<<10)|0;o[0]=o[0]+a|0,o[1]=o[1]+c|0,o[2]=o[2]+l|0,o[3]=o[3]+u|0,o[4]=o[4]+E|0,o[5]=o[5]+B|0,o[6]=o[6]+D|0,o[7]=o[7]+f|0}}$._key=[],$.blockSize=512,$._init=[];var j=Object.freeze({__proto__:null,sha256:$});const Q=new class{constructor(t){this._defaultParanoia=t,this._pools=[new $],this._poolEntropy=[0],this._reseedCount=0,this._robins={},this._eventId=0,this._collectorIds={},this._collectorIdNext=0,this._strength=0,this._poolStrength=0,this._nextReseed=0,this._key=[0,0,0,0,0,0,0,0],this._counter=[0,0,0,0],this._cipher=void 0,this._collectorsStarted=!1,this._callbacks={progress:{},seeded:{}},this._callbackI=0,this._NOT_READY=0,this._READY=1,this._REQUIRES_RESEED=2,this._MAX_WORDS_PER_BURST=65536,this._PARANOIA_LEVELS=[0,48,64,96,128,192,256,384,512,768,1024],this._MILLISECONDS_PER_RESEED=3e4,this._BITS_PER_RESEED=80,this._eventListener={}}randomWords(t,e){var s,r,i=[],n=this.isReady(e);if(n===this._NOT_READY)throw new L("generator isn't seeded");for(n&this._REQUIRES_RESEED&&this._reseedFromPools(!(n&this._READY)),s=0;s<t;s+=4)(s+1)%this._MAX_WORDS_PER_BURST==0&&this._gate(),r=this._gen4words(),i.push(r[0],r[1],r[2],r[3]);return this._gate(),i.slice(0,t)}setDefaultParanoia(t,e){if(0===t&&"Setting paranoia=0 will ruin your security; use it only for testing"!==e)throw"Setting paranoia=0 will ruin your security; use it only for testing";this._defaultParanoia=t}addEntropy(t,e,s){s=s||"user";var r,i,n,o,h=(new Date).valueOf(),a=this._robins[s],c=this.isReady(),l=0;switch(void 0===(r=this._collectorIds[s])&&(r=this._collectorIds[s]=this._collectorIdNext++),void 0===a&&(a=this._robins[s]=0),this._robins[s]=(this._robins[s]+1)%this._pools.length,typeof t){case"number":void 0===e&&(e=1),this._pools[a].update([r,this._eventId++,1,e,h,1,0|t]);break;case"object":if("[object Uint32Array]"===(o=Object.prototype.toString.call(t))){for(n=[],i=0;i<t.length;i++)n.push(t[i]);t=n}else for("[object Array]"!==o&&(l=1),i=0;i<t.length&&!l;i++)"number"!=typeof t[i]&&(l=1);if(!l){if(void 0===e)for(e=0,i=0;i<t.length;i++)for(n=t[i];n>0;)e++,n>>>=1;this._pools[a].update([r,this._eventId++,2,e,h,t.length].concat(t))}break;case"string":void 0===e&&(e=t.length),this._pools[a].update([r,this._eventId++,3,e,h,t.length]),this._pools[a].update(t);break;default:l=1}if(l)throw new O("random: addEntropy only supports number, array of numbers or string");this._poolEntropy[a]+=e,this._poolStrength+=e,c===this._NOT_READY&&(this.isReady()!==this._NOT_READY&&this._fireEvent("seeded",Math.max(this._strength,this._poolStrength)),this._fireEvent("progress",this.getProgress()))}isReady(t){var e=this._PARANOIA_LEVELS[void 0!==t?t:this._defaultParanoia];return this._strength&&this._strength>=e?this._poolEntropy[0]>this._BITS_PER_RESEED&&(new Date).valueOf()>this._nextReseed?this._REQUIRES_RESEED|this._READY:this._READY:this._poolStrength>=e?this._REQUIRES_RESEED|this._NOT_READY:this._NOT_READY}getProgress(t){var e=this._PARANOIA_LEVELS[t||this._defaultParanoia];return this._strength>=e||this._poolStrength>e?1:this._poolStrength/e}startCollectors(){if(!this._collectorsStarted){if("undefined"!=typeof window){if(this._eventListener={loadTimeCollector:this._bind(this._loadTimeCollector),mouseCollector:this._bind(this._mouseCollector),keyboardCollector:this._bind(this._keyboardCollector),accelerometerCollector:this._bind(this._accelerometerCollector),touchCollector:this._bind(this._touchCollector)},!window.addEventListener)throw new O("can't attach event");window.addEventListener("load",this._eventListener.loadTimeCollector,!1),window.addEventListener("keypress",this._eventListener.keyboardCollector,!1)}this._collectorsStarted=!0}}stopCollectors(){this._collectorsStarted&&("undefined"!=typeof window&&window.removeEventListener&&(window.removeEventListener("load",this._eventListener.loadTimeCollector,!1),window.removeEventListener("keypress",this._eventListener.keyboardCollector,!1)),this._collectorsStarted=!1)}addEventListener(t,e){this._callbacks[t][this._callbackI++]=e}removeEventListener(t,e){var s,r,i=this._callbacks[t],n=[];for(r in i)i.hasOwnProperty(r)&&i[r]===e&&n.push(r);for(s=0;s<n.length;s++)delete i[r=n[s]]}_bind(t){var e=this;return function(){t.apply(e,arguments)}}_gen4words(){for(var t=0;t<4&&(this._counter[t]=this._counter[t]+1|0,!this._counter[t]);t++);return this._cipher?.encrypt(this._counter)||[]}_gate(){this._key=this._gen4words().concat(this._gen4words()),this._cipher=new H(this._key)}_reseed(t){this._key=$.hash(this._key.concat(t)),this._cipher=new H(this._key);for(var e=0;e<4&&(this._counter[e]=this._counter[e]+1|0,!this._counter[e]);e++);}_reseedFromPools(t){var e,s=[],r=0;for(this._nextReseed=s[0]=(new Date).valueOf()+this._MILLISECONDS_PER_RESEED,e=0;e<16;e++)s.push(4294967296*Math.random()|0);for(e=0;e<this._pools.length&&(s=s.concat(this._pools[e].finalize()),r+=this._poolEntropy[e],this._poolEntropy[e]=0,t||!(this._reseedCount&1<<e));e++);this._reseedCount>=1<<this._pools.length&&(this._pools.push(new $),this._poolEntropy.push(0)),this._poolStrength-=r,r>this._strength&&(this._strength=r),this._reseedCount++,this._reseed(s)}_keyboardCollector(){this._addCurrentTimeToEntropy(1)}_mouseCollector(t){var e,s;try{e=t.x||t.clientX||t.offsetX||0,s=t.y||t.clientY||t.offsetY||0}catch(t){e=0,s=0}0!=e&&0!=s&&Q.addEntropy([e,s],2,"mouse"),this._addCurrentTimeToEntropy(0)}_touchCollector(t){var e=t.touches[0]||t.changedTouches[0],s=e.pageX||e.clientX,r=e.pageY||e.clientY;Q.addEntropy([s,r],1,"touch"),this._addCurrentTimeToEntropy(0)}_loadTimeCollector(){this._addCurrentTimeToEntropy(2)}_addCurrentTimeToEntropy(t){"undefined"!=typeof window&&"function"==typeof window.performance?.now?Q.addEntropy(window.performance.now(),t,"loadtime"):Q.addEntropy((new Date).valueOf(),t,"loadtime")}_accelerometerCollector(t){var e=t.accelerationIncludingGravity?.x||t.accelerationIncludingGravity?.y||t.accelerationIncludingGravity?.z;if("undefined"!=typeof window&&window.orientation){var s=window.orientation;"number"==typeof s&&Q.addEntropy(s,1,"accelerometer")}e&&Q.addEntropy(e,2,"accelerometer"),this._addCurrentTimeToEntropy(0)}_fireEvent(t,e){var s,r=Q._callbacks[t],i=[];for(s in r)r.hasOwnProperty(s)&&i.push(r[s]);for(s=0;s<i.length;s++)i[s](e)}}(6);var Z=Object.freeze({__proto__:null,BitArray:N,cipher:U,codec:z,exception:P,hash:j,random:Q}),Y=Object.freeze({__proto__:null,BitArray:N,cipher:U,codec:z,default:Z,exception:P,hash:j,random:Q});class W{constructor(t,e,s,r){if(this.initVals={1024:{N:"EEAF0AB9ADB38DD69C33F80AFA8FC5E86072618775FF3C0B9EA2314C9C256576D674DF7496EA81D3383B4813D692C6E0E0D5D8E250B98BE48E495C1D6089DAD15DC7D7B46154D6B6CE8EF4AD69B15D4982559B297BCF1885C529F566660E57EC68EDBC3C05726CC02FD4CBF4976EAA9AFD5138FE8376435B9FC61D2FC0EB06E3",g:"2"},1536:{N:"9DEF3CAFB939277AB1F12A8617A47BBBDBA51DF499AC4C80BEEEA9614B19CC4D5F4F5F556E27CBDE51C6A94BE4607A291558903BA0D0F84380B655BB9A22E8DCDF028A7CEC67F0D08134B1C8B97989149B609E0BE3BAB63D47548381DBC5B1FC764E3F4B53DD9DA1158BFD3E2B9C8CF56EDF019539349627DB2FD53D24B7C48665772E437D6C7F8CE442734AF7CCB7AE837C264AE3A9BEB87F8A2FE9B8B5292E5A021FFF5E91479E8CE7A28C2442C6F315180F93499A234DCF76E3FED135F9BB",g:"2"},2048:{N:"AC6BDB41324A9A9BF166DE5E1389582FAF72B6651987EE07FC3192943DB56050A37329CBB4A099ED8193E0757767A13DD52312AB4B03310DCD7F48A9DA04FD50E8083969EDB767B0CF6095179A163AB3661A05FBD5FAAAE82918A9962F0B93B855F97993EC975EEAA80D740ADBF4FF747359D041D5C33EA71D281E446B14773BCA97B43A23FB801676BD207A436C6481F1D2B9078717461A5B9D32E688F87748544523B524B0D57D5EA77A2775D2ECFA032CFBDBF52FB3786160279004E57AE6AF874E7303CE53299CCC041C7BC308D82A5698F3A8D0C38271AE35F8E9DBFBB694B5C803D89F7AE435DE236D525F54759B65E372FCD68EF20FA7111F9E4AFF73",g:"2"},3072:{N:"FFFFFFFFFFFFFFFFC90FDAA22168C234C4C6628B80DC1CD129024E088A67CC74020BBEA63B139B22514A08798E3404DDEF9519B3CD3A431B302B0A6DF25F14374FE1356D6D51C245E485B576625E7EC6F44C42E9A637ED6B0BFF5CB6F406B7EDEE386BFB5A899FA5AE9F24117C4B1FE649286651ECE45B3DC2007CB8A163BF0598DA48361C55D39A69163FA8FD24CF5F83655D23DCA3AD961C62F356208552BB9ED529077096966D670C354E4ABC9804F1746C08CA18217C32905E462E36CE3BE39E772C180E86039B2783A2EC07A28FB5C55DF06F4C52C9DE2BCBF6955817183995497CEA956AE515D2261898FA051015728E5A8AAAC42DAD33170D04507A33A85521ABDF1CBA64ECFB850458DBEF0A8AEA71575D060C7DB3970F85A6E1E4C7ABF5AE8CDB0933D71E8C94E04A25619DCEE3D2261AD2EE6BF12FFA06D98A0864D87602733EC86A64521F2B18177B200CBBE117577A615D6C770988C0BAD946E208E24FA074E5AB3143DB5BFCE0FD108E4B82D120A93AD2CAFFFFFFFFFFFFFFFF",g:"5"},4096:{N:"FFFFFFFFFFFFFFFFC90FDAA22168C234C4C6628B80DC1CD129024E088A67CC74020BBEA63B139B22514A08798E3404DDEF9519B3CD3A431B302B0A6DF25F14374FE1356D6D51C245E485B576625E7EC6F44C42E9A637ED6B0BFF5CB6F406B7EDEE386BFB5A899FA5AE9F24117C4B1FE649286651ECE45B3DC2007CB8A163BF0598DA48361C55D39A69163FA8FD24CF5F83655D23DCA3AD961C62F356208552BB9ED529077096966D670C354E4ABC9804F1746C08CA18217C32905E462E36CE3BE39E772C180E86039B2783A2EC07A28FB5C55DF06F4C52C9DE2BCBF6955817183995497CEA956AE515D2261898FA051015728E5A8AAAC42DAD33170D04507A33A85521ABDF1CBA64ECFB850458DBEF0A8AEA71575D060C7DB3970F85A6E1E4C7ABF5AE8CDB0933D71E8C94E04A25619DCEE3D2261AD2EE6BF12FFA06D98A0864D87602733EC86A64521F2B18177B200CBBE117577A615D6C770988C0BAD946E208E24FA074E5AB3143DB5BFCE0FD108E4B82D120A92108011A723C12A787E6D788719A10BDBA5B2699C327186AF4E23C1A946834B6150BDA2583E9CA2AD44CE8DBBBC2DB04DE8EF92E8EFC141FBECAA6287C59474E6BC05D99B2964FA090C3A2233BA186515BE7ED1F612970CEE2D7AFB81BDD762170481CD0069127D5B05AA993B4EA988D8FDDC186FFB7DC90A6C08F4DF435C934063199FFFFFFFFFFFFFFFF",g:"5"},6144:{N:"FFFFFFFFFFFFFFFFC90FDAA22168C234C4C6628B80DC1CD129024E088A67CC74020BBEA63B139B22514A08798E3404DDEF9519B3CD3A431B302B0A6DF25F14374FE1356D6D51C245E485B576625E7EC6F44C42E9A637ED6B0BFF5CB6F406B7EDEE386BFB5A899FA5AE9F24117C4B1FE649286651ECE45B3DC2007CB8A163BF0598DA48361C55D39A69163FA8FD24CF5F83655D23DCA3AD961C62F356208552BB9ED529077096966D670C354E4ABC9804F1746C08CA18217C32905E462E36CE3BE39E772C180E86039B2783A2EC07A28FB5C55DF06F4C52C9DE2BCBF6955817183995497CEA956AE515D2261898FA051015728E5A8AAAC42DAD33170D04507A33A85521ABDF1CBA64ECFB850458DBEF0A8AEA71575D060C7DB3970F85A6E1E4C7ABF5AE8CDB0933D71E8C94E04A25619DCEE3D2261AD2EE6BF12FFA06D98A0864D87602733EC86A64521F2B18177B200CBBE117577A615D6C770988C0BAD946E208E24FA074E5AB3143DB5BFCE0FD108E4B82D120A92108011A723C12A787E6D788719A10BDBA5B2699C327186AF4E23C1A946834B6150BDA2583E9CA2AD44CE8DBBBC2DB04DE8EF92E8EFC141FBECAA6287C59474E6BC05D99B2964FA090C3A2233BA186515BE7ED1F612970CEE2D7AFB81BDD762170481CD0069127D5B05AA993B4EA988D8FDDC186FFB7DC90A6C08F4DF435C93402849236C3FAB4D27C7026C1D4DCB2602646DEC9751E763DBA37BDF8FF9406AD9E530EE5DB382F413001AEB06A53ED9027D831179727B0865A8918DA3EDBEBCF9B14ED44CE6CBACED4BB1BDB7F1447E6CC254B332051512BD7AF426FB8F401378CD2BF5983CA01C64B92ECF032EA15D1721D03F482D7CE6E74FEF6D55E702F46980C82B5A84031900B1C9E59E7C97FBEC7E8F323A97A7E36CC88BE0F1D45B7FF585AC54BD407B22B4154AACC8F6D7EBF48E1D814CC5ED20F8037E0A79715EEF29BE32806A1D58BB7C5DA76F550AA3D8A1FBFF0EB19CCB1A313D55CDA56C9EC2EF29632387FE8D76E3C0468043E8F663F4860EE12BF2D5B0B7474D6E694F91E6DCC4024FFFFFFFFFFFFFFFF",g:"5"},8192:{N:"FFFFFFFFFFFFFFFFC90FDAA22168C234C4C6628B80DC1CD129024E088A67CC74020BBEA63B139B22514A08798E3404DDEF9519B3CD3A431B302B0A6DF25F14374FE1356D6D51C245E485B576625E7EC6F44C42E9A637ED6B0BFF5CB6F406B7EDEE386BFB5A899FA5AE9F24117C4B1FE649286651ECE45B3DC2007CB8A163BF0598DA48361C55D39A69163FA8FD24CF5F83655D23DCA3AD961C62F356208552BB9ED529077096966D670C354E4ABC9804F1746C08CA18217C32905E462E36CE3BE39E772C180E86039B2783A2EC07A28FB5C55DF06F4C52C9DE2BCBF6955817183995497CEA956AE515D2261898FA051015728E5A8AAAC42DAD33170D04507A33A85521ABDF1CBA64ECFB850458DBEF0A8AEA71575D060C7DB3970F85A6E1E4C7ABF5AE8CDB0933D71E8C94E04A25619DCEE3D2261AD2EE6BF12FFA06D98A0864D87602733EC86A64521F2B18177B200CBBE117577A615D6C770988C0BAD946E208E24FA074E5AB3143DB5BFCE0FD108E4B82D120A92108011A723C12A787E6D788719A10BDBA5B2699C327186AF4E23C1A946834B6150BDA2583E9CA2AD44CE8DBBBC2DB04DE8EF92E8EFC141FBECAA6287C59474E6BC05D99B2964FA090C3A2233BA186515BE7ED1F612970CEE2D7AFB81BDD762170481CD0069127D5B05AA993B4EA988D8FDDC186FFB7DC90A6C08F4DF435C93402849236C3FAB4D27C7026C1D4DCB2602646DEC9751E763DBA37BDF8FF9406AD9E530EE5DB382F413001AEB06A53ED9027D831179727B0865A8918DA3EDBEBCF9B14ED44CE6CBACED4BB1BDB7F1447E6CC254B332051512BD7AF426FB8F401378CD2BF5983CA01C64B92ECF032EA15D1721D03F482D7CE6E74FEF6D55E702F46980C82B5A84031900B1C9E59E7C97FBEC7E8F323A97A7E36CC88BE0F1D45B7FF585AC54BD407B22B4154AACC8F6D7EBF48E1D814CC5ED20F8037E0A79715EEF29BE32806A1D58BB7C5DA76F550AA3D8A1FBFF0EB19CCB1A313D55CDA56C9EC2EF29632387FE8D76E3C0468043E8F663F4860EE12BF2D5B0B7474D6E694F91E6DBE115974A3926F12FEE5E438777CB6A932DF8CD8BEC4D073B931BA3BC832B68D9DD300741FA7BF8AFC47ED2576F6936BA424663AAB639C5AE4F5683423B4742BF1C978238F16CBE39D652DE3FDB8BEFC848AD922222E04A4037C0713EB57A81A23F0C73473FC646CEA306B4BCBC8862F8385DDFA9D4B7FA2C087E879683303ED5BDD3A062B3CF5B3A278A66D2A13F83F44F82DDF310EE074AB6A364597E899A0255DC164F31CC50846851DF9AB48195DED7EA1B1D510BD7EE74D73FAF36BC31ECFA268359046F4EB879F924009438B481C6CD7889A002ED5EE382BC9190DA6FC026E479558E4475677E9AA9E3050E2765694DFC81F56E880B96E7160C980DD98EDD3DFFFFFFFFFFFFFFFFF",g:"19"}},!t)throw"Username cannot be empty.";this.username=t,this.password=e,this.hashFn=r||"sha-1";var n=this.initVals[s||1024];this.N=new i(n.N,16),this.g=new i(n.g,16),this.k=this.kPrecompute(),this.one=new i("1",16),this.two=new i("2",16)}toHexString(t){let e=t.toString(16);return e.length%2==1&&(e="0"+e),e}padLeft(t,e){if(t.length>e)return t;return Array(e-t.length+1).join("0")+t}bytesToHex(t){const e=this;return t.map((function(t){return e.padLeft(e.toHexString(t),2)})).join("")}hexToBytes(t){if(t.length%2==1)throw new Error("hexToBytes can't have a string with an odd number of characters.");return 0===t.indexOf("0x")&&(t=t.slice(2)),t.match(/../g)?.map((function(t){return parseInt(t,16)}))||[]}stringToBytes(t){let e=[];for(var s=0;s<t.length;++s)e.push(t.charCodeAt(s));return e}bytesToString(t){let e="";for(var s=0;s<t.length;s++)e+=String.fromCharCode(t[s]);return e}kPrecompute(){const t=[this.toHexString(this.N),this.toHexString(this.g)];return this.paddedHash(t)}calculateX(t){if(!t)throw new Error("Missing parameter.");if(!this.username||!this.password)throw new Error("Username and password cannot be empty.");const e=this.stringToBytes(this.username),s=this.hexToBytes(this.password),r=e.concat([58]).concat(s),n=this.hash(this.bytesToString(r)),o=this.hexToBytes(n),h=this.hexToBytes(t).concat(o),a=this.hash(this.bytesToString(h)),c=new i(a,16);if(c.compareTo(this.N)<0)return c;{const t=new i(1,16);return c.mod(this.N.subtract(t))}}calculateV(t){if(!t)throw"Missing parameter.";const e=this.calculateX(t);return this.g.modPow(e,this.N)}calculateU(t,e){if(!t||!e)throw"Missing parameter(s).";if("0"==t.mod(this.N).toString()||"0"==e.mod(this.N).toString())throw"ABORT: illegal_parameter";const s=[this.toHexString(t),this.toHexString(e)];return this.paddedHash(s)}canCalculateA(t){if(!t)throw"Missing parameter.";return Math.ceil(t.bitLength()/8)>=32}calculateA(t){if(!t)throw"Missing parameter.";if(!this.canCalculateA(t))throw"Client key length is less than 256 bits.";const e=this.g.modPow(t,this.N);if("0"==e.mod(this.N).toString())throw"ABORT: illegal_parameter";return e}calculateM1(t,e,s,r){if(!(t&&e&&s&&r))throw"Missing parameter(s).";if("0"==t.mod(this.N).toString()||"0"==e.mod(this.N).toString())throw"ABORT: illegal_parameter";const n=this.hexHash(this.toHexString(this.N)),o=this.hexHash(this.toHexString(this.g)),h=this.hash(this.username);for(var a=[],c=this.hexToBytes(n),l=this.hexToBytes(o),u=0;u<c.length;u++)a[u]=c[u]^l[u];for(var E=[this.bytesToHex(a),h,r,this.toHexString(t),this.toHexString(e),s],B="",D=0;D<E.length;D++)B+=E[D];return new i(this.hexHash(B),16)}calculateM(t,e,s,r){if(!(t&&e&&s&&r))throw"Missing parameter(s).";if("0"==t.mod(this.N).toString()||"0"==e.mod(this.N).toString())throw"ABORT: illegal_parameter";const i=this.hexHash(this.toHexString(this.N)),n=this.hexHash(this.toHexString(this.g)),o=this.hash(this.username);for(var h=[],a=this.hexToBytes(i),c=this.hexToBytes(n),l=0;l<a.length;l++)h[l]=a[l]^c[l];for(var u=[this.bytesToHex(h),o,r,this.toHexString(t),this.toHexString(e),s],E="",B=0;B<u.length;B++)E+=u[B];return this.hexHash(E)}calculateM2(t,e,s){if(!t||!e||!s)throw"Missing parameter(s).";if("0"==t.mod(this.N).toString()||"0"==e.mod(this.N).toString())throw"ABORT: illegal_parameter";const r=[this.toHexString(t),this.toHexString(e),s];let n="";for(var o=0;o<r.length;o++)n+=r[o];return new i(this.hexHash(n),16)}calculateS(t,e,s,r){if(!(t&&e&&s&&r))throw"Missing parameters.";if("0"==t.mod(this.N).toString())throw"ABORT: illegal_parameter";const i=this.calculateX(e),n=this.g.modPow(i,this.N);return t.add(this.N.multiply(this.k)).subtract(n.multiply(this.k)).mod(this.N).modPow(i.multiply(s).add(r),this.N)}calculateK(t){return this.hexHash(this.toHexString(t))}srpRandom(){const t=Z.random.randomWords(8,0),e=Z.codec.hex.fromBits(t);if(64!=e.length)throw"Invalid random number size.";let s=new i(e,16);return s.compareTo(this.N)>=0&&(s=s.mod(this.N.subtract(this.one))),s.compareTo(this.two)<0&&(s=this.two),s}randomHexSalt(){const t=Z.random.randomWords(8,0);return Z.codec.hex.fromBits(t)}paddedHash(t){const e=2*(4*this.toHexString(this.N).length+7>>3);let s="";for(var r=0;r<t.length;r++)s+=this.nZeros(e-t[r].length)+t[r];return new i(this.hexHash(s),16).mod(this.N)}hash(t){if("sha-256"===this.hashFn.toLowerCase()){const e=Z.codec.hex.fromBits(Z.hash.sha256.hash(t));return this.nZeros(64-e.length)+e}return M(t)}hexHash(t){if("sha-256"===this.hashFn.toLowerCase()){const e=Z.codec.hex.fromBits(Z.hash.sha256.hash(Z.codec.hex.toBits(t)));return this.nZeros(64-e.length)+e}return this.hash(this.pack(t))}pack(t){t.length%2!=0&&(t="0"+t);let e=0,s="";for(;e<t.length/2;)s+=String.fromCharCode(parseInt(t.substr(2*e,2),16)),e++;return s}nZeros(t){if(t<1)return"";const e=this.nZeros(t>>1);return 0==(1&t)?e+e:e+e+"0"}calculateB(t,e){if(!t||!e)throw"Missing parameters.";return this.g.modPow(t,this.N).add(e.multiply(this.k)).mod(this.N)}calculateServerS(t,e,s,r){if(!(t&&e&&s&&r))throw"Missing parameters.";if("0"==t.mod(this.N).toString()||"0"==r.mod(this.N).toString())throw"ABORT: illegal_parameter";return e.modPow(s,this.N).multiply(t).mod(this.N).modPow(r,this.N)}}function X(){const t={};return t.promise=new Promise(((e,s)=>{t.resolve=e,t.reject=s})),t}function K(t,e,s){const r=new Promise((function(r,i){const n=new XMLHttpRequest;if(n.open(t,e,!0),n.responseType="json",n.setRequestHeader("Accept","application/json"),n.onreadystatechange=function(){if(this.readyState===XMLHttpRequest.DONE)if(200===this.status){let t;t=""===this.responseType&&"string"==typeof this.responseText?JSON.parse(this.responseText):this.response,r(t)}else i(this)},"post"===t.toLowerCase()&&s){var o,h,a=[];for(h in s)a.push(`${encodeURIComponent(h)}=${encodeURIComponent(s[h])}`);o=a.join("&").replace(/%20/g,"+"),n.send(o)}else n.send()}));return r}class G{constructor(t){this.m_items=[],this.m_items=[],this.m_maxSize=t}trimHead(){this.m_items.length>this.m_maxSize&&this.m_items.splice(0,this.m_items.length-this.m_maxSize)}trimTail(){this.m_items.length>this.m_maxSize&&this.m_items.splice(this.m_maxSize,this.m_items.length-this.m_maxSize)}push(...t){this.m_items.push(...t),this.trimHead()}splice(t,e){const s=this.m_items.splice(t,e);return this.trimTail(),s}unshift(...t){const e=this.m_items.unshift(...t);return this.trimTail(),e}get length(){return this.m_items.length}get items(){return this.m_items}}const J="websdk",tt="websdk.sessionId";const et=new class{constructor(){this.session={port:0,host:"127.0.0.1",secure:!0,srpClient:null};try{const t=sessionStorage.getItem(J),e=t&&JSON.parse(t);e&&(this.session=e)}catch(t){}}async ensureLoaded(){try{if(this.session.port&&this.session.host&&this.session.srpClient)return{};const t=await K("get","https://127.0.0.1:52181/get_connection");if(this.parseHostReply(t?.endpoint))return{}}catch(t){}return{error:"Cannot load configuration"}}parseHostReply(t){const s=function(t){const s=function(t){if(e(`Configurator: DpHost string: "${t}"`),t){const[e,s]=t.split("?"),r=`hostname=127.0.0.1&${s}`.split("&")||[];return Object.fromEntries(r.map((t=>t.split("="))))}}(t);if(!s)return;const r={host:s.hostname,port:parseInt(s.web_sdk_port||""),secure:"true"===s.web_sdk_secure,srpClient:{p1:s.web_sdk_username,p2:s.web_sdk_password,salt:s.web_sdk_salt}};if(r.port&&r.host&&r.srpClient?.p1&&r.srpClient.p2&&r.srpClient.salt)return r}(t);return!!s&&(this.session=s,sessionStorage.setItem(J,JSON.stringify(s)),!0)}getDpHostConnectionUrl(){const{port:t,host:e,secure:s}=this.session;if(!t||!e)throw new Error("No connection url");return`${`${s?"https":"http"}://${e}:${t.toString()}`}/connect`}getDpAgentConnectionUrl({dpAgentChannelId:t,M1:e="no.M1"}){const{port:s,host:i,secure:n}=this.session;if(!s||!i||!this.session.srpClient)throw new Error("No port,host,srpClient");const o=`${n?"https":"http"}://${i}:${s.toString()}`;let h=this.sessionId;h||(this.sessionId=h=Y.codec.hex.fromBits(Y.random.randomWords(2,0)));let a=`${o.replace("http","ws")}/${t}?username=${this.session.srpClient.p1}&M1=${e}`;return a+=`&sessionId=${this.sessionId}`,a+=`&version=${r.version.toString()}`,a}get sessionId(){return sessionStorage.getItem(tt)}set sessionId(t){t?sessionStorage.setItem(tt,t):sessionStorage.removeItem(tt)}};var st=1,rt={Binary:1,UnicodeString:2,UTF8String:3};function it(t){const e=function(t){const e=encodeURIComponent(t);return e.replace(/%([0-9A-F]{2})/g,((t,e)=>String.fromCharCode(parseInt(e,16))))}(t);return btoa(e)}function nt(t){return function(t){const e=t.replace(/(.)/g,(function(t,e){let s=e.charCodeAt(0).toString(16).toUpperCase();return s.length<2&&(s="0"+s),`%${s}`}));return decodeURIComponent(e)}(atob(t))}function ot(t,e){return Array.prototype.map.call(e,(t=>t)).map(((e,s)=>String.fromCharCode(e.charCodeAt(0)^function(t,e){return t.charCodeAt(Math.floor(e%t.length))}(t,s)))).join("")}function ht(t,e){const s=new DataView(t);s.setUint8(0,st),s.setUint8(1,e),s.setUint32(2,t.byteLength-8,!0),s.setUint16(6,8,!0)}function at(t){return globalThis.crypto.subtle.importKey("raw",t,{name:"AES-CBC"},!1,["encrypt","decrypt"])}function ct(t,e,s){const r=new Uint8Array(Et(e).buffer,0,16);let i;return i="string"==typeof s?function(t){const e=new ArrayBuffer(2*t.length+8);ht(e,rt.UnicodeString);const s=new Uint16Array(e,8);for(var r=0,i=t.length;r<i;r++)s[r]=t.charCodeAt(r);return e}(s):function(t){const e=new ArrayBuffer(t.length+8);ht(e,rt.Binary);const s=new Uint8Array(t);return new Uint8Array(e,8).set(s),e}(s),function(t,e,s){return at(e).then((function(e){return function(t,e,s){return globalThis.crypto.subtle.encrypt({name:"AES-CBC",iv:s},e,t)}(t,e,s)}))}(i,t,r)}function lt(t,e,s){return function(t,e,s){return at(e).then((function(e){return function(t,e,s){return globalThis.crypto.subtle.decrypt({name:"AES-CBC",iv:s},e,t)}(t,e,s)}))}(s,t,new Uint8Array(Et(e).buffer,0,16)).then((function(t){const e=function(t){const e=new DataView(t);return{version:e.getUint8(0),type:e.getUint8(1),length:e.getUint32(2,!0),offset:e.getUint16(6,!0)}}(t);if(e.version!==st)throw new Error("Invalid data version!");switch(e.type){case rt.Binary:return Bt(t.slice(e.offset));case rt.UnicodeString:return s=t.slice(e.offset),new Promise((function(t,e){const r=new Blob([new Uint8Array(s)]),i=new FileReader;i.onload=function(e){return t(e.target?.result)},i.onerror=function(t){return e(t.target?.error)},i.readAsText(r,"utf-16")}));default:throw new Error("Invalid data type!")}var s}))}function ut(e,s,i){if(!e||!s)throw new Error("Invalid key|M1");switch(r.version){case t.AESEncryption:return ct(e,s,i);case t.Encryption:return Bt(it(ot(s,i)));case t.Encoding:return Bt(it(i));default:return Bt(i)}}function Et(t){if(t.length%2==1)throw new Error("hexToBytes can't have a string with an odd number of characters.");return 0===t.indexOf("0x")&&(t=t.slice(2)),new Uint8Array((t.match(/../g)||[]).map((t=>parseInt(t,16))))}function Bt(t){return new Promise((function(e,s){setTimeout((function(){e(t)}))}))}class Dt{constructor(t){if(this.wsThreshold=10240,this.wsQueueInterval=1e3,this.wsQueueLimit=100,this.wsReconnectInterval=5e3,this.queue=new G(this.wsQueueLimit),this.queueInterval=null,this.reconnectTimer=null,this.webSocket=null,this.sessionKey=null,this.onConnectionFailed=null,this.onConnectionSucceed=null,this.onDataReceivedBin=null,this.onDataReceivedTxt=null,this.reportError=t=>{const e=(t instanceof Error?t.message:t.toString())||"tm.error.connect";console.error(e)},e(`wccImpl.constructor({version: ${r.version}, dpAgentClientId: "${t}"})`),!t)throw new Error("clientPath cannot be empty");this.dpAgentChannelId=t}wsconnect(t){e(`wccImpl.wsconnect(${t})`);const s=X();if(this.webSocket&&this.webSocket.readyState!==WebSocket.CLOSED)throw new Error("disconnect has not been called");return this.webSocket=new WebSocket(t),this.webSocket.binaryType="arraybuffer",this.webSocket.onclose=t=>(e("wccImpl.wsonclose()"),this.wsonclose(!0)),this.webSocket.onopen=function(t){e("wccImpl.wsonopen()"),s.resolve()},this.webSocket.onerror=function(t){return e(`wccImpl.wsonerror(${arguments})`),s.reject(new Error("WebSocket connection failed."))},this.webSocket.onmessage=t=>this.wsonmessage(t),s.promise}wsdisconnect(){const t=this,e=X();return this.webSocket&&this.webSocket.readyState===WebSocket.OPEN?(this.webSocket.onclose=function(s){t.wsonclose(!1),e.resolve()},this.webSocket.close()):e.resolve(),e.promise}wsonclose(t){e("wccImpl.wsonclose()"),this.webSocket&&(this.webSocket.onclose=null,this.webSocket.onopen=null,this.webSocket.onmessage=null,this.webSocket.onerror=null),this.stopMessageQueueInterval(),t&&this.onConnectionFailed?.()}wsonmessage(e){(function(e,s,i){if(!e||!s)throw new Error("Invalid key|M1");switch(r.version){case t.AESEncryption:return lt(e,s,i);case t.Encryption:return Bt(ot(s,nt(i)));case t.Encoding:return Bt(nt(i));default:return Bt(i)}})(this.sessionKey,this.M1,e.data).then((t=>"string"==typeof t?this.onDataReceivedTxt?.(t):this.onDataReceivedBin?.(t)))}sendDataBin(t){ut(this.sessionKey,this.M1,t).then((t=>this.sendData(t))).catch(this.reportError)}sendDataTxt(t){ut(this.sessionKey,this.M1,t).then((t=>this.sendData(t))).catch(this.reportError)}sendData(t){this.wssend(t)||this.queue.push(t)}wssend(t){return!(!this.isConnected()||!this.webSocket)&&(this.webSocket.bufferedAmount>=this.wsThreshold?(this.startMessageQueueInterval(),!1):(this.webSocket.send(t),!0))}isConnected(){return!!this.webSocket&&this.webSocket.readyState===WebSocket.OPEN}stopMessageQueueInterval(){this.queueInterval&&(clearInterval(this.queueInterval),this.queueInterval=null)}startMessageQueueInterval(){this.queueInterval||(this.queueInterval=setInterval((()=>this.processMessageQueue()),this.wsQueueInterval))}processMessageQueue(){if(this.queue.length){e(`wccImpl.processMessageQueue(${this.queue.length})`);for(;0<this.queue.length&&this.wssend(this.queue.items[0]);)this.queue.splice(0,1);0===this.queue.length&&this.stopMessageQueueInterval()}}stopReconnectTimer(){this.reconnectTimer&&(clearInterval(this.reconnectTimer),this.reconnectTimer=null)}startReconnectTimer(){this.stopReconnectTimer(),this.reconnectTimer=setInterval((()=>this.tryConnectNTimes(1)),this.wsReconnectInterval)}async connect(){await this.tryConnectNTimes(3)}async disconnect(){await this.wsdisconnect()}async generateSessionKey(){try{const e=et.session.srpClient;if(!e?.p1||!e.p2||!e.salt)return{error:"No data available for authentication"};const s=new W(e.p1,e.p2);let n;do{n=s.srpRandom()}while(!s.canCalculateA(n));const o=s.calculateA(n),h=await K("post",et.getDpHostConnectionUrl(),{username:e.p1,A:s.toHexString(o),version:r.version.toString()});r.version=h.version??Math.min(r.version,t.Encryption);const a=new i(h.B,16),c=s.calculateU(o,a),l=s.calculateS(a,e.salt,c,n),u=s.calculateK(l),E=s.calculateM(o,a,u,e.salt);return this.sessionKey=function(t){return Et(t)}(Y.codec.hex.fromBits(Y.hash.sha256.hash(Y.codec.hex.toBits(u)))),this.M1=E,{data:E}}catch(t){return{error:(t instanceof Error?t.message:t.toString())||"tm.error.key"}}}async setupSecureChannel(){e("wccImpl.setupSecureChannel()");const t=await this.generateSessionKey();if(t.error)return t;try{const t=et.getDpAgentConnectionUrl({dpAgentChannelId:this.dpAgentChannelId,M1:this.M1});return await this.wsconnect(t),{}}catch(t){return e(t),{error:(t instanceof Error?t.message:t.toString())||"tm.error.key"}}}async tryConnectNTimes(t){if(e("wccImpl.connectInternal()"),this.stopReconnectTimer(),!this.isConnected())try{const e=await et.ensureLoaded();if(e.error)throw new Error(e.error);let s,r=t;do{s=await this.setupSecureChannel()}while(s.error&&--r>0);if(s.error)throw new Error(s.error);this.onConnectionSucceed?.(),this.processMessageQueue()}catch(t){this.onConnectionFailed?.((t instanceof Error?t.message:t.toString())||"tm.error.connect")}}}class ft{constructor(t,i){if(i){e(i);const t=new s(i);r.debug=t.debug,r.version=t.version}this.impl=new Dt(t)}connect(){return this.impl.connect()}disconnect(){return this.impl.disconnect()}isConnected(){return this.impl.isConnected()}sendDataBin(t){this.impl.sendDataBin(t)}sendDataTxt(t){this.impl.sendDataTxt(t)}resetReconnectTimer(){this.impl.stopReconnectTimer()}get onConnectionFailed(){return this.impl.onConnectionFailed}set onConnectionFailed(t){this.impl.onConnectionFailed=t}get onConnectionSucceed(){return this.impl.onConnectionSucceed}set onConnectionSucceed(t){this.impl.onConnectionSucceed=t}get onDataReceivedBin(){return this.impl.onDataReceivedBin}set onDataReceivedBin(t){this.impl.onDataReceivedBin=t}get onDataReceivedTxt(){return this.impl.onDataReceivedTxt}set onDataReceivedTxt(t){this.impl.onDataReceivedTxt=t}}export{ft as WebChannelClient,Dt as WebChannelClientImpl,s as WebChannelOptions};
